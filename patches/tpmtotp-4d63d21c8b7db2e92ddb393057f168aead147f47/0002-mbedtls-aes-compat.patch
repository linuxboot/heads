--- a/libtpm/mbedtls-compat.h
+++ b/libtpm/mbedtls-compat.h
@@ -92,7 +92,9 @@
 #define AES_cbc_encrypt(in, out, len, key, ivec, dir) \
 	mbedtls_aes_crypt_cbc(key, dir, len, ivec, in, out)
 
-#define AES_encrypt mbedtls_aes_encrypt
+/* Provide an AES_encrypt wrapper with the OpenSSL-like call order used by the TPM
+   code: AES_encrypt(in, out, key) -> mbedtls_aes_crypt_ecb(ctx, MBEDTLS_AES_ENCRYPT, in, out) */
+#define AES_encrypt(in, out, key) mbedtls_aes_crypt_ecb((mbedtls_aes_context *)(key), MBEDTLS_AES_ENCRYPT, (in), (out))
 
 //--------------------------------------------------
 
