From 4ca5b0f3a4a9cc467fb423c043a3c4927b3880a1 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Micha=C5=82=20=C5=BBygowski?= <michal.zygowski@3mdeb.com>
Date: Fri, 22 Sep 2023 16:30:05 +0200
Subject: [PATCH 3/4] src/mainboard/msi/ms7e06/devicetree.cb: Add fan control
 config
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Signed-off-by: Michał Żygowski <michal.zygowski@3mdeb.com>
Change-Id: I7a207a8555466f3c4ce888ad7ed90367ff2ae12e
---
 src/mainboard/msi/ms7e06/devicetree.cb | 157 +++++++++++++++++++++++++
 1 file changed, 157 insertions(+)

diff --git a/src/mainboard/msi/ms7e06/devicetree.cb b/src/mainboard/msi/ms7e06/devicetree.cb
index eb179885c1..5885f2ab27 100644
--- a/src/mainboard/msi/ms7e06/devicetree.cb
+++ b/src/mainboard/msi/ms7e06/devicetree.cb
@@ -203,6 +203,163 @@ chip soc/intel/alderlake
 			register "gen4_dec" = "0x000c0081"
 
 			chip superio/nuvoton/nct6687d
+				register "sensors[0]" = "PECI_AGENT0_DOMAIN0"
+				register "sensors[1]" = "TD0P_CURRENT_MODE"
+				register "sensors[2]" = "THERMISTOR15"
+				register "sensors[3]" = "PCH_CHIP"
+				register "sensors[4]" = "THERMISTOR16"
+				register "sensors[5]" = "THERMISTOR0"
+				register "sensors[6]" = "THERMISTOR1"
+				register "sensors[16]" = "VIN0"
+				register "sensors[17]" = "VIN1"
+				register "sensors[18]" = "VIN2"
+				register "sensors[19]" = "VIN3"
+				register "sensors[20]" = "VIN4"
+				register "sensors[21]" = "VIN5"
+				register "sensors[22]" = "VIN6"
+				register "sensors[23]" = "VIN7"
+				register "sensors[24]" = "VCC"
+
+				register "smbus_sensor.sensor_idx" = "3"
+				register "smbus_sensor.sensor_en" = "true"
+				register "smbus_sensor.sensor_cmd" = "0x40"
+				register "smbus_sensor.sensor_addr" = "0x96"
+				register "smbus_sensor.baud_rate" = "BAUD_100K"
+				register "smbus_sensor.report_one_byte" = "true"
+				register "smbus_sensor.port_sel" = "1"
+
+				register "peci_speed" = "PECI_1200KHZ"
+
+				register "fan_default_val" = "60"
+
+				register "smart_tracking.speed_boundary_low" = "1500"
+				register "smart_tracking.speed_boundary_high" = "2500"
+				register "smart_tracking.rpm_tolerance_low" = "100"
+				register "smart_tracking.rpm_tolerance_mid" = "100"
+				register "smart_tracking.rpm_tolerance_high" = "100"
+				register "smart_tracking.step_up" = "1"
+				register "smart_tracking.step_down" = "1"
+
+				# CPU_FAN
+				register "FAN1.mode" = "FAN_SMART_FAN_IV"
+				register "FAN1.unit_sel" = "FAN_PWM"
+				register "FAN1.fanin_sel" = "TACH_PWM1"
+				register "FAN1.fanout_sel" = "TACH_PWM0"
+				register "FAN1.fan_alg_weight" = "10"
+				register "FAN1.smart_tracking_en" = "true"
+				register "FAN1.crit_temp" = "101"
+				register "FAN1.smart_fan.temp_src" = "{ 1, 0, 0, 0 }"
+				register "FAN1.smart_fan.temp_levels" = "{ 40, 55, 70, 85, 90, 95, 100 }"
+				register "FAN1.smart_fan.speed_levels" = "{ 13, 38, 63, 85, 90, 95, 100 }"
+				register "FAN1.smart_fan.cut_off_delay" = "5"
+				register "FAN1.smart_fan.step_up_time" = "1"
+				register "FAN1.smart_fan.step_down_time" = "1"
+
+				# PUMP_FAN
+				register "FAN2.mode" = "FAN_SMART_FAN_IV"
+				register "FAN2.unit_sel" = "FAN_PWM"
+				register "FAN2.fanin_sel" = "TACH_PWM3"
+				register "FAN2.fanout_sel" = "TACH_PWM2"
+				register "FAN2.fan_alg_weight" = "10"
+				register "FAN2.smart_tracking_en" = "true"
+				register "FAN2.crit_temp" = "101"
+				register "FAN2.smart_fan.temp_src" = "{ 1, 0, 0, 0 }"
+				register "FAN2.smart_fan.temp_levels" = "{ 32, 32, 32, 32, 32, 32, 32 }"
+				register "FAN2.smart_fan.speed_levels" = "{ 100, 100, 100, 100, 100, 100, 100 }"
+				register "FAN2.smart_fan.cut_off_delay" = "5"
+				register "FAN2.smart_fan.step_up_time" = "1"
+				register "FAN2.smart_fan.step_down_time" = "1"
+
+				# SYS_FAN1
+				register "FAN3.mode" = "FAN_SMART_FAN_IV"
+				register "FAN3.unit_sel" = "FAN_PWM"
+				register "FAN3.fanin_sel" = "TACH_PWM11"
+				register "FAN3.fanout_sel" = "TACH_PWM10"
+				register "FAN3.fan_alg_weight" = "10"
+				register "FAN3.smart_tracking_en" = "true"
+				register "FAN3.crit_temp" = "101"
+				register "FAN3.smart_fan.temp_src" = "{ 1, 0, 0, 0 }"
+				register "FAN3.smart_fan.temp_levels" = "{ 10, 20, 30, 40, 50, 60, 70 }"
+				register "FAN3.smart_fan.speed_levels" = "{ 60, 60, 60, 60, 60, 60, 60 }"
+				register "FAN3.smart_fan.cut_off_delay" = "5"
+				register "FAN3.smart_fan.step_up_time" = "1"
+				register "FAN3.smart_fan.step_down_time" = "1"
+
+				# SYS_FAN2
+				register "FAN4.mode" = "FAN_SMART_FAN_IV"
+				register "FAN4.unit_sel" = "FAN_PWM"
+				register "FAN4.fanin_sel" = "TACH_PWM13"
+				register "FAN4.fanout_sel" = "TACH_PWM12"
+				register "FAN4.fan_alg_weight" = "10"
+				register "FAN4.smart_tracking_en" = "true"
+				register "FAN4.crit_temp" = "101"
+				register "FAN4.smart_fan.temp_src" = "{ 1, 0, 0, 0 }"
+				register "FAN4.smart_fan.temp_levels" = "{ 10, 20, 30, 40, 50, 60, 70 }"
+				register "FAN4.smart_fan.speed_levels" = "{ 60, 60, 60, 60, 60, 60, 60 }"
+				register "FAN4.smart_fan.cut_off_delay" = "5"
+				register "FAN4.smart_fan.step_up_time" = "1"
+				register "FAN4.smart_fan.step_down_time" = "1"
+
+				# SYS_FAN3
+				register "FAN5.mode" = "FAN_SMART_FAN_IV"
+				register "FAN5.unit_sel" = "FAN_PWM"
+				register "FAN5.fanin_sel" = "TACH_PWM15"
+				register "FAN5.fanout_sel" = "TACH_PWM14"
+				register "FAN5.fan_alg_weight" = "10"
+				register "FAN5.smart_tracking_en" = "true"
+				register "FAN5.crit_temp" = "101"
+				register "FAN5.smart_fan.temp_src" = "{ 1, 0, 0, 0 }"
+				register "FAN5.smart_fan.temp_levels" = "{ 10, 20, 30, 40, 50, 60, 70 }"
+				register "FAN5.smart_fan.speed_levels" = "{ 60, 60, 60, 60, 60, 60, 60 }"
+				register "FAN5.smart_fan.cut_off_delay" = "5"
+				register "FAN5.smart_fan.step_up_time" = "1"
+				register "FAN5.smart_fan.step_down_time" = "1"
+
+				# SYS_FAN4
+				register "FAN6.mode" = "FAN_SMART_FAN_IV"
+				register "FAN6.unit_sel" = "FAN_PWM"
+				register "FAN6.fanin_sel" = "TACH_PWM17"
+				register "FAN6.fanout_sel" = "TACH_PWM16"
+				register "FAN6.fan_alg_weight" = "10"
+				register "FAN6.smart_tracking_en" = "true"
+				register "FAN6.crit_temp" = "101"
+				register "FAN6.smart_fan.temp_src" = "{ 1, 0, 0, 0 }"
+				register "FAN6.smart_fan.temp_levels" = "{ 10, 20, 30, 40, 50, 60, 70 }"
+				register "FAN6.smart_fan.speed_levels" = "{ 60, 60, 60, 60, 60, 60, 60 }"
+				register "FAN6.smart_fan.cut_off_delay" = "5"
+				register "FAN6.smart_fan.step_up_time" = "1"
+				register "FAN6.smart_fan.step_down_time" = "1"
+
+				# SYS_FAN5
+				register "FAN7.mode" = "FAN_SMART_FAN_IV"
+				register "FAN7.unit_sel" = "FAN_PWM"
+				register "FAN7.fanin_sel" = "TACH_PWM19"
+				register "FAN7.fanout_sel" = "TACH_PWM18"
+				register "FAN7.fan_alg_weight" = "10"
+				register "FAN7.smart_tracking_en" = "true"
+				register "FAN7.crit_temp" = "101"
+				register "FAN7.smart_fan.temp_src" = "{ 1, 0, 0, 0 }"
+				register "FAN7.smart_fan.temp_levels" = "{ 10, 20, 30, 40, 50, 60, 70 }"
+				register "FAN7.smart_fan.speed_levels" = "{ 60, 60, 60, 60, 60, 60, 60 }"
+				register "FAN7.smart_fan.cut_off_delay" = "5"
+				register "FAN7.smart_fan.step_up_time" = "1"
+				register "FAN7.smart_fan.step_down_time" = "1"
+
+				# SYS_FAN6
+				register "FAN8.mode" = "FAN_SMART_FAN_IV"
+				register "FAN8.unit_sel" = "FAN_PWM"
+				register "FAN8.fanin_sel" = "TACH_PWM6"
+				register "FAN8.fanout_sel" = "TACH_PWM4"
+				register "FAN8.fan_alg_weight" = "10"
+				register "FAN8.smart_tracking_en" = "true"
+				register "FAN8.crit_temp" = "101"
+				register "FAN8.smart_fan.temp_src" = "{ 1, 0, 0, 0 }"
+				register "FAN8.smart_fan.temp_levels" = "{ 10, 20, 30, 40, 50, 60, 70 }"
+				register "FAN8.smart_fan.speed_levels" = "{ 60, 60, 60, 60, 60, 60, 60 }"
+				register "FAN8.smart_fan.cut_off_delay" = "5"
+				register "FAN8.smart_fan.step_up_time" = "1"
+				register "FAN8.smart_fan.step_down_time" = "1"
+
 				device pnp 4e.1 off end		# Parallel port
 				device pnp 4e.2 on		# COM1
 					io 0x60 = 0x3f8
-- 
2.49.0

