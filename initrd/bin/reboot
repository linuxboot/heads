#!/bin/ash
. /etc/ash_functions

TRACE "Under /bin/reboot"

# Shut down TPM
if [ "$CONFIG_TPM" = "y" ]; then
	tpmr shutdown
fi

# Run special EC-based poweroff for Nitropad-Nxx
if [ "${CONFIG_BOARD%_*}" = nitropad-nv41 || "${CONFIG_BOARD%_*}" = nitropad-ns51 ]; then
	/bin/nitropad-shutdown.sh
fi

# Sync all mounted filesystems
echo s > /proc/sysrq-trigger

# Remount all mounted filesystems in read-only mode
echo u > /proc/sysrq-trigger

# Immediately reboot the system, without unmounting or syncing filesystems
echo b > /proc/sysrq-trigger
