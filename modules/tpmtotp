modules-$(CONFIG_TPMTOTP) += tpmtotp

tpmtotp_depends := mbedtls qrencode $(musl_dep)

tpmtotp_version := 4d63d21c8b7db2e92ddb393057f168aead147f47
tpmtotp_dir := tpmtotp-$(tpmtotp_version)
tpmtotp_tar := tpmtotp-$(tpmtotp_version).tar.gz
tpmtotp_url := https://github.com/osresearch/tpmtotp/archive/$(tpmtotp_version).tar.gz
tpmtotp_hash := eaac1e8f652f1da7f5a1ed6a8cfefb6511f1e5e1dabf93b44db3b29c18c5ae53

# OFLAG status: FIXED â€” CFLAGS set to `-Oz` (overrides many cases) and a _configure `sed` applied to replace remaining `-O3` occurrences in generated Makefiles; validated on x86 and ppc64 (see build/x86/log/tpmtotp.log, build/ppc64/log/tpmtotp.log).
# Inventory classification: OK - validated (x86 & ppc64)

tpmtotp_configure := \
	sed -E -i 's/-O[0-9]+/-Oz/g' Makefile util/Makefile libtpm/Makefile || true

tpmtotp_target := \
	$(CROSS_TOOLS) \
	$(MAKE_JOBS) \
	CFLAGS="-I$(INSTALL)/include -Oz" \
	LDFLAGS="-L$(INSTALL)/lib" \


tpmtotp_output := \
	totp \
	hotp \
	qrenc \
	util/tpm \

tpmtotp_libraries := \
	libtpm/libtpm.so \
