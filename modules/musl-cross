ifeq "$(MUSL_CROSS_ONCE)" ""
MUSL_CROSS_ONCE := 1


ifneq "$(CROSS)" ""

# check that $(CROSS)gcc exists or else things just won't work
ifneq "y" "$(shell [ -x '$(CROSS)gcc' ] && echo y)"
$(error $(CROSS)gcc does not exist - can not build)
endif

# The cross compiler has already been built, so the musl-cross target
# is a NOP.
#musl-cross.intermediate:

musl-cross_dir := musl-cross-ext
$(build)/$(musl-cross_dir)/.build:
	mkdir -p $(dir $@)
	touch $@

else

# Force a full build of the cross compiler

modules-y += musl-cross
musl-cross_version := 3b5b118f1cdddecda3f04b5005f69f962278fc1e
musl-cross_dir := musl-cross
musl-cross_url := https://github.com/GregorR/musl-cross/archive/$(musl-cross_version).tar.gz
musl-cross_tar := musl-cross-$(musl-cross_version).tar.gz
musl-cross_hash := 050c41b7c724fd1b007bc06680274e6c8f203436a9ab727f7bdc227d7c40f079

CROSS_TOP := crossgcc/x86_64-linux-musl/bin/x86_64-linux-musl-
CROSS := $(build)/../$(CROSS_TOP)
musl-cross_output := ../../$(CROSS_TOP)gcc

musl-cross_configure := \
	/bin/echo -e > Makefile \
	'$(musl-cross_output):\n\tCC_BASE_PREFIX="$(pwd)/crossgcc" ./build.sh'


endif

musl-cross_target :=

endif
