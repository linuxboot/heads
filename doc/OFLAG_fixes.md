OFLAG fixes summary

This document lists recent OFLAG (optimization flag) fixes applied in the repository and where to find validation evidence.

- zlib
  - Fix: packaging enforces CFLAGS=-Oz
  - Validation: V=1 builds on x86 & ppc64 show -Oz usage in compile lines
  - Logs: build/x86/log/zlib.log, build/ppc64/log/zlib.log

- cryptsetup2
  - Fix: pre-configure substitutions applied (remove -O3 from Argon2 templates and normalize libtool hardcode flags)
  - Commit: fac65ebc7e
  - Validation: V=1 x86 & ppc64 builds validated; grep shows no remaining -O3 in build trees
  - Logs: build/ppc64/log/cryptsetup2.log, build/x86/log/cryptsetup2.log

- cryptsetup (legacy)
  - Packaging change: pre-configure sed added to normalize `-O[0-9]+`/`-Os` -> `-Oz` and `CXXFLAGS` set to `-g -Oz` in `modules/cryptsetup`.
  - Note: this module is not used by current boards (`cryptsetup2` is the active module); change applied for completeness.

- slang
  - Fix: minimal pre-configure sed applied replacing -O2 with -Oz
  - Validation: logged CFLAGS show -Oz in build output
  - Logs: build/x86/log/slang.log

- libaio
  - Fix: pre-configure sed applied to replace `-O[0-9]+` and `-Os` with `-Oz`.
  - Validation: V=1 x86 & ppc64 builds show `-Oz` in compile and link lines (see `build/x86/log/libaio.log` and `build/ppc64/log/libaio.log`).

- tpmtotp
  - Fix: guarded pre-build sed replaces -O[0-9]+ with -Oz in generated Makefile fragments (Makefile, util/Makefile, libtpm/Makefile)
  - Validation: V=1 builds completed for x86 & ppc64 and grep shows no remaining -O3 in build trees
  - Logs: build/x86/log/tpmtotp.log, build/ppc64/log/tpmtotp.log

- tpm2-tools
  - Fix: pre-configure sed normalizes `-O[0-9]+`/`-Os` -> `-Oz` and `CFLAGS`/`CXXFLAGS` set to `-g -Oz` defensively in `modules/tpm2-tools`.
  - Validation: V=1 x86 build completed and compile/link lines show `-Oz`; TODO: run ppc64 validation if relevant.
  - Logs: build/x86/log/tpm2-tools.log

- dropbear
  - Fix: packaging-time sed normalizes optimization flags to `-Oz` (replaces `-O[0-9]+` & `-Os` with `-Oz`) and configure is invoked with size-friendly env vars where applicable.
  - Validation: V=1 x86 build shows `-Oz` in configure and build logs; a size regression vs an older CircleCI artifact was observed (investigate toolchain vs package changes).
  - Logs: build/x86/dropbear-2025.88/config.log

- kexec-tools
  - Fix: packaging-time pre-configure sed normalizes `-O[0-9]+`/`-Os` -> `-Oz` and removes Makefile backup artifacts.
  - Validation: V=1 x86 & ppc64 builds show `-Oz` only in compile/link lines.

Notes & next steps
- `.bak` files left in the build trees are artifacts of the reversible sed step; remove them for cleanliness if desired or keep them as audit evidence.
- For cross-arch completeness, consider running per-package V=1 builds on additional arches (arm64, riscv) for packages that still show legacy -O tokens in non-built files.
- Kernel config note: changes to enable `CONFIG_TMPFS` and `CONFIG_MEMFD_CREATE` have been applied repository-wide; see the header comment in `initrd/bin/kexec-boot` for rationale and validation guidance.

Sed normalization patterns
- Generic pre-configure sed applied across multiple modules normalizes optimization flags to `-Oz`:
  - Pattern: `sed -e 's/-O[0-9]\+/-Oz/g' -e 's/-Os/-Oz/g'`
  - Placement: applied in `module_configure` target before `./configure` invocation or in pre-build hooks.
  - Artifact cleanup: `.bak` files generated by sed are kept or removed per module policy (kept for audit evidence by default).
